
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Register | Enejistats</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * { box-sizing: border-box; }
    body { margin: 0; font-family: 'Segoe UI', sans-serif; background-color: #f5f7fa; color: #333; }
    header, footer { background-color: #1e1e2f; color: white; padding: 1rem; text-align: center; }
    nav { margin-top: 0.5rem; }
    nav a { color: white; margin: 0 0.75rem; text-decoration: none; font-weight: 500; }
    main { max-width: 800px; margin: 2rem auto; padding: 2rem; background: white; border-radius: 8px; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); }
    h2 { text-align: center; color: #004aad; }
    form { display: flex; flex-direction: column; }
    label { margin-top: 1rem; font-weight: bold; }
    
    .input-group {
      position: relative;
      display: flex;
      align-items: center;
    }
    
    input, select {
      padding: 0.6rem;
      border-radius: 5px;
      border: 1px solid #ccc;
      margin-top: 0.3rem;
      width: 100%;
    }
    
    .password-toggle {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      cursor: pointer;
      color: #666;
      font-size: 1.2rem;
      z-index: 1;
    }
    
    .validation-icon {
      position: absolute;
      right: 40px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 1.2rem;
    }
    
    .validation-icon.success { color: green; }
    .validation-icon.error { color: red; }
    
    .photo-preview {
      max-width: 150px;
      max-height: 150px;
      margin-top: 10px;
      border-radius: 5px;
      display: none;
    }
    
    button {
      background-color: #004aad;
      color: white;
      padding: 0.8rem;
      border: none;
      border-radius: 5px;
      margin-top: 1.5rem;
      cursor: pointer;
      font-size: 1rem;
    }
    
    button:hover { background-color: #003688; }
    button:disabled { background-color: #ccc; cursor: not-allowed; }
    
    .error-message {
      color: red;
      font-size: 0.9rem;
      margin-top: 0.3rem;
      display: none;
    }
    
    .success-message {
      color: green;
      font-size: 0.9rem;
      margin-top: 0.3rem;
      display: none;
    }
  </style>
</head>
<body>
  <header>
    <h1>Enejistats</h1>
    <nav>
      <a href="/">Home</a>
      <a href="/register">Register</a>
      <a href="/login">Login</a>
    </nav>
  </header>

  <main>
    <h2>Player Registration</h2>
    <form id="registrationForm" enctype="multipart/form-data">
      <label for="full_name">Full Name:</label>
      <div class="input-group">
        <input type="text" id="full_name" name="full_name" required />
        <span class="validation-icon" id="name-icon"></span>
      </div>
      <div class="error-message" id="name-error"></div>

      <label for="email">Email:</label>
      <div class="input-group">
        <input type="email" id="email" name="email" required />
        <span class="validation-icon" id="email-icon"></span>
      </div>
      <div class="error-message" id="email-error"></div>

      <label for="phone">Phone Number:</label>
      <div class="input-group">
        <input type="tel" id="phone" name="phone" required />
        <span class="validation-icon" id="phone-icon"></span>
      </div>

      <label for="state">State:</label>
      <div class="input-group">
        <select id="state" name="state" required>
          <option value="">Select State</option>
          <option value="Lagos">Lagos</option>
          <option value="Abuja">Abuja</option>
          <option value="Kano">Kano</option>
          <option value="Rivers">Rivers</option>
          <option value="Oyo">Oyo</option>
          <option value="Delta">Delta</option>
          <option value="Kaduna">Kaduna</option>
          <option value="Ogun">Ogun</option>
          <option value="Imo">Imo</option>
          <option value="Borno">Borno</option>
          <option value="Anambra">Anambra</option>
          <option value="Akwa Ibom">Akwa Ibom</option>
          <option value="Osun">Osun</option>
          <option value="Ondo">Ondo</option>
          <option value="Enugu">Enugu</option>
          <option value="Kwara">Kwara</option>
          <option value="Abia">Abia</option>
          <option value="Adamawa">Adamawa</option>
          <option value="Cross River">Cross River</option>
          <option value="Jigawa">Jigawa</option>
          <option value="Gombe">Gombe</option>
          <option value="Sokoto">Sokoto</option>
          <option value="Benue">Benue</option>
          <option value="Yobe">Yobe</option>
          <option value="Taraba">Taraba</option>
          <option value="Kebbi">Kebbi</option>
          <option value="Plateau">Plateau</option>
          <option value="Zamfara">Zamfara</option>
          <option value="Bauchi">Bauchi</option>
          <option value="Kogi">Kogi</option>
          <option value="Katsina">Katsina</option>
          <option value="Niger">Niger</option>
          <option value="Ebonyi">Ebonyi</option>
          <option value="Edo">Edo</option>
          <option value="Ekiti">Ekiti</option>
          <option value="Bayelsa">Bayelsa</option>
          <option value="Nasarawa">Nasarawa</option>
        </select>
        <span class="validation-icon" id="state-icon"></span>
      </div>

      <label for="gender">Gender:</label>
      <div class="input-group">
        <select id="gender" name="gender" required>
          <option value="">Select Gender</option>
          <option value="Male">Male</option>
          <option value="Female">Female</option>
        </select>
        <span class="validation-icon" id="gender-icon"></span>
      </div>

      <label for="password">Password:</label>
      <div class="input-group">
        <input type="password" id="password" name="password" required />
        <span class="validation-icon" id="password-icon"></span>
        <span class="password-toggle" onclick="togglePassword('password')">üëÅÔ∏è</span>
      </div>

      <label for="confirm_password">Confirm Password:</label>
      <div class="input-group">
        <input type="password" id="confirm_password" name="confirm_password" required />
        <span class="validation-icon" id="confirm-password-icon"></span>
        <span class="password-toggle" onclick="togglePassword('confirm_password')">üëÅÔ∏è</span>
      </div>
      <div class="error-message" id="password-error"></div>

      <label for="photo">Photo (max 200KB):</label>
      <div class="input-group">
        <input type="file" id="photo" name="photo" accept="image/*" required />
        <span class="validation-icon" id="photo-icon"></span>
      </div>
      <img id="photoPreview" class="photo-preview" />
      <div class="error-message" id="photo-error"></div>

      <button type="submit" id="submitBtn">Register</button>
      <div class="success-message" id="success-message"></div>
      <div class="error-message" id="general-error"></div>
    </form>
  </main>

  <footer>
    <p>&copy; 2024 Enejistats. All rights reserved.</p>
  </footer>

  <script>
    function togglePassword(fieldId) {
      const field = document.getElementById(fieldId);
      const icon = field.nextElementSibling.nextElementSibling;
      
      if (field.type === 'password') {
        field.type = 'text';
        icon.textContent = 'üôà';
      } else {
        field.type = 'password';
        icon.textContent = 'üëÅÔ∏è';
      }
    }

    function showValidationIcon(fieldId, isValid) {
      const icon = document.getElementById(fieldId + '-icon');
      if (isValid) {
        icon.textContent = '‚úì';
        icon.className = 'validation-icon success';
      } else {
        icon.textContent = '‚óè';
        icon.className = 'validation-icon error';
      }
    }

    function hideValidationIcon(fieldId) {
      const icon = document.getElementById(fieldId + '-icon');
      icon.textContent = '';
      icon.className = 'validation-icon';
    }

    // Real-time validation
    document.getElementById('full_name').addEventListener('input', function() {
      const value = this.value.trim();
      if (value.length > 2) {
        // Check if user exists
        fetch(`/check-user?full_name=${encodeURIComponent(value)}`)
          .then(response => response.json())
          .then(data => {
            if (data.exists) {
              showValidationIcon('name', false);
              document.getElementById('name-error').textContent = 'User with this name already exists';
              document.getElementById('name-error').style.display = 'block';
            } else {
              showValidationIcon('name', true);
              document.getElementById('name-error').style.display = 'none';
            }
          });
      } else {
        hideValidationIcon('name');
      }
    });

    document.getElementById('email').addEventListener('input', function() {
      const value = this.value.trim();
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      
      if (emailRegex.test(value)) {
        // Check if email exists
        fetch(`/check-user?email=${encodeURIComponent(value)}`)
          .then(response => response.json())
          .then(data => {
            if (data.exists) {
              showValidationIcon('email', false);
              document.getElementById('email-error').textContent = 'Email already registered';
              document.getElementById('email-error').style.display = 'block';
            } else {
              showValidationIcon('email', true);
              document.getElementById('email-error').style.display = 'none';
            }
          });
      } else {
        hideValidationIcon('email');
      }
    });

    document.getElementById('phone').addEventListener('input', function() {
      const value = this.value.trim();
      if (value.length >= 10) {
        showValidationIcon('phone', true);
      } else {
        hideValidationIcon('phone');
      }
    });

    document.getElementById('state').addEventListener('change', function() {
      if (this.value) {
        showValidationIcon('state', true);
      } else {
        hideValidationIcon('state');
      }
    });

    document.getElementById('gender').addEventListener('change', function() {
      if (this.value) {
        showValidationIcon('gender', true);
      } else {
        hideValidationIcon('gender');
      }
    });

    document.getElementById('password').addEventListener('input', function() {
      const value = this.value;
      if (value.length >= 6) {
        showValidationIcon('password', true);
      } else {
        hideValidationIcon('password');
      }
      checkPasswordMatch();
    });

    document.getElementById('confirm_password').addEventListener('input', function() {
      checkPasswordMatch();
    });

    function checkPasswordMatch() {
      const password = document.getElementById('password').value;
      const confirmPassword = document.getElementById('confirm_password').value;
      
      if (confirmPassword && password === confirmPassword) {
        showValidationIcon('confirm-password', true);
        document.getElementById('password-error').style.display = 'none';
      } else if (confirmPassword) {
        showValidationIcon('confirm-password', false);
        document.getElementById('password-error').textContent = 'Passwords do not match';
        document.getElementById('password-error').style.display = 'block';
      } else {
        hideValidationIcon('confirm-password');
      }
    }

    document.getElementById('photo').addEventListener('change', function() {
      const file = this.files[0];
      const preview = document.getElementById('photoPreview');
      const errorDiv = document.getElementById('photo-error');
      
      if (file) {
        // Check file size (200KB = 204800 bytes)
        if (file.size > 204800) {
          showValidationIcon('photo', false);
          errorDiv.textContent = 'Photo size must be less than 200KB';
          errorDiv.style.display = 'block';
          preview.style.display = 'none';
        } else {
          showValidationIcon('photo', true);
          errorDiv.style.display = 'none';
          
          // Show preview
          const reader = new FileReader();
          reader.onload = function(e) {
            preview.src = e.target.result;
            preview.style.display = 'block';
          };
          reader.readAsDataURL(file);
        }
      } else {
        hideValidationIcon('photo');
        preview.style.display = 'none';
      }
    });

    // Form submission
    document.getElementById('registrationForm').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const submitBtn = document.getElementById('submitBtn');
      const successDiv = document.getElementById('success-message');
      const errorDiv = document.getElementById('general-error');
      
      submitBtn.disabled = true;
      submitBtn.textContent = 'Registering...';
      
      const formData = new FormData(this);
      
      fetch('/register', {
        method: 'POST',
        body: formData
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          successDiv.textContent = data.message;
          successDiv.style.display = 'block';
          errorDiv.style.display = 'none';
          this.reset();
          // Hide all validation icons
          document.querySelectorAll('.validation-icon').forEach(icon => {
            icon.textContent = '';
            icon.className = 'validation-icon';
          });
          document.getElementById('photoPreview').style.display = 'none';
        } else {
          errorDiv.textContent = data.message;
          errorDiv.style.display = 'block';
          successDiv.style.display = 'none';
        }
      })
      .catch(error => {
        errorDiv.textContent = 'An unexpected error occurred. Please try again.';
        errorDiv.style.display = 'block';
        successDiv.style.display = 'none';
      })
      .finally(() => {
        submitBtn.disabled = false;
        submitBtn.textContent = 'Register';
      });
    });
  </script>
</body>
</html>
